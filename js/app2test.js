/** DATA * */

/*
 * All lessons have a slot - these are the numbers 1 .. 40 which correspond to
 * the lesson throughout the week
 */
var table = [ {
	lessons : [ {
		day : "Monday",
		slot : 1,
		name : "Maths",
		time : "09:05",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Robson",
	}, {
		day : "Monday",
		slot : 2,
		name : "Geography",
		time : "09:45",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Powell",
	}, {
		day : "Monday",
		slot : 3,
		name : "English",
		time : "10:20",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Sadler",
	}, {
		day : "Monday",
		slot : 4,
		name : "Morning Break",
		time : "10:55",
		duration : 20,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Monday",
		slot : 5,
		name : "German",
		time : "11:15",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Hansen",
	}, {
		day : "Monday",
		slot : 6,
		name : "Physics",
		time : "11:50",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Wilks",
	}, {
		day : "Monday",
		slot : 7,
		name : "Physics",
		time : "12:30",
		duration : 60,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Wilks",
	}, {
		day : "Monday",
		slot : 8,
		name : "Lunch Break",
		time : "13:05",
		duration : 65,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Monday",
		slot : 9,
		name : "Spanish",
		time : "14:15",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Reece",
	}, {
		day : "Monday",
		slot : 10,
		name : "Spanish",
		time : "14:55",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Reece",

	} ]
}, {
	lessons : [ {
		day : "Tuesday",
		slot : 1,
		name : "Music",
		time : "09:05",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 2,
		name : "Music",
		time : "09:45",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 3,
		name : "Maths",
		time : "10:20",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Robson",
	}, {
		day : "Tuesday",
		slot : 4,
		name : "Morning Break",
		time : "10:55",
		duration : 20,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 5,
		name : "RE",
		time : "11:15",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 6,
		name : "German",
		time : "11:50",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Hansen",
	}, {
		day : "Tuesday",
		slot : 7,
		name : "German",
		time : "12:30",
		duration : 60,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Hansen",
	}, {
		day : "Tuesday",
		slot : 8,
		name : "Lunch Break",
		time : "13:05",
		duration : 65,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 9,
		name : "Games",
		time : "14:15",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Tuesday",
		slot : 10,
		name : "Games",
		time : "14:55",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",

	} ]
}, {
	lessons : [ {
		day : "Wednesday",
		slot : 1,
		name : "English",
		time : "09:05",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Sadler",
	}, {
		day : "Wednesday",
		slot : 2,
		name : "P.E.",
		time : "09:45",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 3,
		name : "P.E.",
		time : "10:20",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 4,
		name : "Morning Break",
		time : "10:55",
		duration : 20,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 5,
		name : "Maths",
		time : "11:15",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Robson",
	}, {
		day : "Wednesday",
		slot : 6,
		name : "Technology",
		time : "11:50",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 7,
		name : "Technology",
		time : "12:30",
		duration : 60,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 8,
		name : "Lunch Break",
		time : "13:05",
		duration : 65,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 9,
		name : "Biology",
		time : "14:15",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Wednesday",
		slot : 10,
		name : "Biology",
		time : "14:55",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",

	} ]
}, {
	lessons : [ {
		day : "Thursday",
		slot : 1,
		name : "English",
		time : "09:05",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Sadler",
	}, {
		day : "Thursday",
		slot : 2,
		name : "ICT",
		time : "09:45",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 3,
		name : "Spanish",
		time : "10:20",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Reece",
	}, {
		day : "Thursday",
		slot : 4,
		name : "Morning Break",
		time : "10:55",
		duration : 20,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 5,
		name : "History",
		time : "11:15",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 6,
		name : "Chemistry",
		time : "11:50",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 7,
		name : "Chemistry",
		time : "12:30",
		duration : 60,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 8,
		name : "Lunch Break",
		time : "13:05",
		duration : 65,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Thursday",
		slot : 9,
		name : "Geography",
		time : "14:15",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Powell",
	}, {
		day : "Thursday",
		slot : 10,
		name : "RE",
		time : "14:55",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",

	} ]
}, {
	lessons : [ {
		day : "Friday",
		slot : 1,
		name : "Geography",
		time : "09:05",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Powell",
	}, {
		day : "Friday",
		slot : 2,
		name : "Art",
		time : "09:45",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 3,
		name : "Art",
		time : "10:20",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 4,
		name : "Morning Break",
		time : "10:55",
		duration : 20,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 5,
		name : "English",
		time : "11:15",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mrs Sadler",
	}, {
		day : "Friday",
		slot : 6,
		name : "Roundabout",
		time : "11:50",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 7,
		name : "Roundabout",
		time : "12:30",
		duration : 60,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 8,
		name : "Lunch Break",
		time : "13:05",
		duration : 65,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 9,
		name : "History",
		time : "14:15",
		duration : 40,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "",
	}, {
		day : "Friday",
		slot : 10,
		name : "Maths",
		time : "14:55",
		duration : 35,
		homeworkdue : "",
		notes : "",
		done : true,
		teacher : "Mr Robson",

	} ]
}

];

var app = angular.module('mainpage',
		[ 'ui.bootstrap', 'ngCookies', 'ngAnimate' ]);
app.controller(
				'mainController2',
				function($scope, $cookies, $log, $timeout) {

					
					var JStimetable = [];
					// These getters and setters can be changed to use any
					// datasource
					$scope.getData = function() {

						// reads the cookie lessonData if it is null then it
						// uses the predefined one above.
						if ($cookies.getObject("lessonData0") != null) {
							JStimetable.push(angular.fromJson($cookies
									.getObject("lessonData0")));
							JStimetable.push(angular.fromJson($cookies
									.getObject("lessonData1")));
							JStimetable.push(angular.fromJson($cookies
									.getObject("lessonData2")));
							JStimetable.push(angular.fromJson($cookies
									.getObject("lessonData3")));
							JStimetable.push(angular.fromJson($cookies
									.getObject("lessonData4")));

						} else {
							JStimetable = table;
						}
						;
						$scope.timetable = JStimetable;
					};

					$scope.getData();

					// Sets the data for a homework - writes it to a cookie
					$scope.setData = function(day, lesson, date, notes, done) {
						JStimetable = $scope.timetable;
						// $log.log("day: "+day+" lesson:"+lesson+" Date:
						// "+date+" Notes: "+notes);
						JStimetable[day].lessons[lesson].notes = notes;
						JStimetable[day].lessons[lesson].homeworkdue = date;
						JStimetable[day].lessons[lesson].done = done;

						var lessonData = []; // to store JSON cookies
						for ( var i = 0; i < JStimetable.length; i++) {

							lessonData[i] = angular.toJson(JStimetable[i]);

							$cookies.putObject('lessonData' + i, lessonData[i]);
						}

						$scope.timetable = JStimetable;
					};

					$scope.timetable = JStimetable;

					
					$scope.getDate = function() {
						$log.log("returning: " + new Date());
						return new Date();
					};

					$scope.dateOptions = {
						minDate : new Date(2014, 11, 1),
						maxDate : new Date(2015, 1, 28),
						initDate : new Date(2015, 0, 9)
					};

					// Accordion
					$scope.status1 = {
							isFirstOpen : false,
							isFirstDisabled : false
						};
					$scope.status2 = {
							isFirstOpen : false,
							isFirstDisabled : false
						};

					
					var when = [
					{date:"Sat Nov 29 2015 00:00:00 GMT+0000 (GMT Standard Time)"},
					{date:"2015-08-07"}
					];
					
					getDate = function(day,lesson) {
						$log.log("Date = "+$scope.timetable[day].lessons[lesson].homeworkdue)
						return when[day].date;
					};					
					
					

					
					$scope.dt = [[]];
					
					$scope.today = function() {
						$scope.dt[0][0] = getDate(0,1);
						$scope.dt[0][1] = getDate(1,1);
					};
					$scope.today();

					$scope.clear = function() {
						$scope.dt = null;
					};

					// Disable weekend selection
					$scope.disabled = function(date, mode) {
						return (mode === 'day' && (date.getDay() === 0 || date
								.getDay() === 6));
					};

					$scope.toggleMin = function() {
						$scope.minDate = $scope.minDate ? null : new Date();
					};
					$scope.toggleMin();
					$scope.maxDate = new Date(2020, 5, 22);

					$scope.open = function($event) {
						$scope.status1.opened = true;
					};
					
					$scope.open = function($event) {
						$scope.status2.opened = true;
					};

					$scope.setDate = function(year, month, day) {
						$scope.dt = new Date(year, month, day);
					};

					$scope.dateOptions = {
						formatYear : 'yy',
						startingDay : 1
					};

					$scope.formats = [ 'dd-MMMM-yyyy', 'yyyy/MM/dd',
							'dd.MM.yyyy', 'shortDate' ];
					$scope.format = $scope.formats[0];

					$scope.status1 = {
							opened : false
						};
					$scope.status2 = {
							opened : false
						};

					var tomorrow = new Date();
					tomorrow.setDate(tomorrow.getDate() + 1);
					var afterTomorrow = new Date();
					afterTomorrow.setDate(tomorrow.getDate() + 2);
					$scope.events = [ {
						date : tomorrow,
						status : 'full'
					}, {
						date : afterTomorrow,
						status : 'partially'
					} ];

					$scope.getDayClass = function(date, mode) {
						if (mode === 'day') {
							var dayToCheck = new Date(date)
									.setHours(0, 0, 0, 0);

							for ( var i = 0; i < $scope.events.length; i++) {
								var currentDay = new Date($scope.events[i].date)
										.setHours(0, 0, 0, 0);

								if (dayToCheck === currentDay) {
									return $scope.events[i].status;
								}
							}
						}

						return '';
					};
				});
